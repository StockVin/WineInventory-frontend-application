<section class="order-detail" *ngIf="order$ | async as order; else notFound">
  <app-side-navbar></app-side-navbar>
  <header class="order-detail__header">
    <div>
      <h1>{{ 'order-detail.title' | translate: { code: order.orderNumber } }}</h1>
      <p>{{ 'order-detail.text' | translate: { date: (order.orderedAt | date:'medium') } }}</p>
    </div>
    <div class="order-detail__actions">
      <select [value]="order.status" (change)="updateStatus(order, $any($event.target).value)">
        <option *ngFor="let status of statusOptions" [value]="status">{{ statusLabels[status] | translate }}</option>
      </select>
      <button
        type="button"
        class="order-detail__delete"
        (click)="deleteOrder(order)"
        [disabled]="isDeleting"
      >
        {{ isDeleting ? ('order-detail.deleting' | translate) : ('order-detail.delete' | translate) }}
      </button>
      <button type="button" (click)="goBack()">{{ 'order-detail.button' | translate }}</button>
    </div>
  </header>
  <app-language-switcher></app-language-switcher>
  <section class="order-detail__info">
    <article>
      <h2>{{ 'order-detail.customer' | translate }}</h2>
      <p class="order-detail__customer">{{ order.delivery.recipientName }}</p>
      <p>{{ order.delivery.addressLine }}, {{ order.delivery.city }}, {{ order.delivery.country }}</p>
      <p>{{ order.delivery.contactPhone }}</p>
      <p *ngIf="order.customerEmail">{{ order.customerEmail }}</p>
      <p *ngIf="order.notes" class="order-detail__notes">{{ order.notes }}</p>
    </article>
    <article>
      <h2>{{ 'order-detail.delivery' | translate }}</h2>
      <p>{{ 'order-detail.expected' | translate: { date: (order.deliveryDate | date:'mediumDate') } }}</p>
      <p>
        {{ 'order-detail.status' | translate }}
        <span class="badge" [class]="'badge ' + (order.status | lowercase)">{{ statusLabels[order.status] | translate }}</span>
      </p>
    </article>
    <article>
      <h2>{{ 'order-detail.summary' | translate }}</h2>
      <p>{{ 'order-detail.subtotal' | translate }} : <strong>{{ order.subtotalAmount.amount | currency:order.subtotalAmount.currency:'symbol':'1.0-0' }}</strong></p>
      <p>{{ 'order-detail.tax' | translate }} : <strong>{{ order.taxAmount.amount | currency:order.taxAmount.currency:'symbol':'1.0-0' }}</strong></p>
      <p>{{ 'order-detail.total' | translate }} : <strong>{{ order.totalAmount.amount | currency:order.totalAmount.currency:'symbol':'1.0-0' }}</strong></p>
    </article>
  </section>

  <section class="order-detail__items">
    <h2>{{ 'order-detail.items' | translate }}</h2>
    <table>
      <thead>
      <tr>
        <th>{{ 'order-detail.table.reference' | translate }}</th>
        <th>{{ 'order-detail.table.varietal' | translate }}</th>
        <th>{{ 'order-detail.table.vintage' | translate }}</th>
        <th>{{ 'order-detail.table.quantity' | translate }}</th>
        <th>{{ 'order-detail.table.unitPrice' | translate }}</th>
        <th>{{ 'order-detail.table.total' | translate }}</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let item of order.items">
        <td>
          <span class="item-name">{{ item.productName }}</span>
          <small>#{{ item.productId }}</small>
        </td>
        <td>—</td>
        <td>—</td>
        <td>{{ item.quantity }}</td>
        <td>{{ item.unitPrice.amount | currency:item.unitPrice.currency:'symbol':'1.0-0' }}</td>
        <td>{{ item.lineTotal.amount | currency:item.lineTotal.currency:'symbol':'1.0-0' }}</td>
      </tr>
      </tbody>
    </table>
  </section>
</section>

<ng-template #notFound>
  <div class="order-detail__empty">
    <h2>{{ 'order-detail.empty.title' | translate }}</h2>
    <p>{{ 'order-detail.empty.description' | translate }}</p>
    <a routerLink="/orders">{{ 'order-detail.empty.backToList' | translate }}</a>
  </div>
</ng-template>
