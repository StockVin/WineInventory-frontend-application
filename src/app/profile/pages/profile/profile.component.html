<div class="profile-layout">
  <app-side-navbar></app-side-navbar>
  <section class="workspace" [class.workspace--settings]="isSettingsView()">
    <header class="workspace__header">
      <div class="header__title">
        <div class="header__icon material-symbols-outlined">
          {{ isProfileView() ? 'person' : isAccountView() ? 'account_circle' : 'workspace_premium' }}
        </div>
        <div>
          <h1>
            {{ isProfileView() ? 'Perfil' : isAccountView() ? 'Cuenta' : 'Beneficios' }}
          </h1>
          <p *ngIf="isProfileView()">Gestiona tu información personal y datos de contacto.</p>
          <p *ngIf="isAccountView()">Administra tu suscripción y configuración de cuenta.</p>
          <p *ngIf="isBenefitView()">Conoce todos los beneficios de tu plan actual.</p>
        </div>
      </div>

      <div class="header__right">
        <div class="header__status-chip" *ngIf="accountStatus() as status">
          <span class="material-symbols-outlined">verified</span>
          {{ status.statusLabel }}
        </div>
        <app-language-switcher></app-language-switcher>
      </div>
    </header>

    <p class="workspace__error" *ngIf="loadError() as errorMessage">{{ errorMessage }}</p>
    <ng-container *ngIf="!isLoading(); else loading">
      <ng-container *ngIf="profile() as currentProfile; else emptyProfile">

        <!-- Profile View -->
        <ng-container *ngIf="isProfileView()">
          <div class="summary-grid">
            <article class="card profile-overview">
              <div class="profile-overview__header">
                <div class="profile-overview__avatar">
                  <ng-container *ngIf="currentProfile.avatarUrl && !overviewAvatarError(); else overviewInitials">
                    <img
                      [src]="currentProfile.avatarUrl"
                      [alt]="'Foto de ' + currentProfile.fullName"
                      (error)="handleOverviewAvatarError()"
                    />
                  </ng-container>
                  <ng-template #overviewInitials>
                    <div class="profile-overview__initials">
                      {{ computeInitials(currentProfile.fullName) }}
                    </div>
                  </ng-template>
                </div>
                <div>
                  <div class="profile-overview__id">{{ currentProfile.id }}</div>
                  <h2>{{ currentProfile.fullName }}</h2>
                  <p>{{ currentProfile.role }}</p>
                </div>
              </div>
              <dl class="profile-overview__details">
                <div>
                  <dt class="material-symbols-outlined">mail</dt>
                  <dd>{{ currentProfile.email }}</dd>
                </div>
                <div>
                  <dt class="material-symbols-outlined">call</dt>
                  <dd>{{ currentProfile.phone }}</dd>
                </div>
                <div>
                  <dt class="material-symbols-outlined">location_on</dt>
                  <dd>{{ currentProfile.location }}</dd>
                </div>
                <div>
                  <dt class="material-symbols-outlined">person</dt>
                  <dd>&#64;{{ currentProfile.username }}</dd>
                </div>
              </dl>
              <div class="profile-overview__actions">
                <button type="button" class="primary-button" (click)="goToSettings()">
                  Editar perfil
                </button>
              </div>
            </article>

            <!-- Plan Details Section -->
            <div class="plan-details-section">
              <app-plan-details
                class="plan-details-container"
                [plans]="plans()"
                [selectedPlanId]="selectedPlanId()"
                [disabled]="isSaving()"
                (planSelected)="handlePlanSelected($event)"
              ></app-plan-details>
            </div>
          </div>
        </ng-container>
      </ng-container>
    </ng-container>
  </section>
</div>

<ng-template #loading>
  <div class="workspace__loading">
    <span class="material-symbols-outlined">hourglass_empty</span>
    Cargando información del perfil…
  </div>
</ng-template>

<ng-template #emptyProfile>
  <div class="workspace__empty">
    <span class="material-symbols-outlined">person_off</span>
    No encontramos información del perfil para mostrar.
  </div>
</ng-template>
